// tquery.js - https://github.com/jeromeetienne/tquery - MIT License
var tQuery=function(a,b){if(a instanceof THREE.Object3D&&tQuery.Object3D)return new tQuery.Object3D(a);if(a instanceof THREE.Geometry&&tQuery.Geometry)return new tQuery.Geometry(a);if(a instanceof THREE.Material&&tQuery.Material)return new tQuery.Material(a);if("string"===typeof a&&tQuery.Object3D)return new tQuery.Object3D(a,b);console.assert(!1,"unsupported type")};tQuery.VERSION="0.0.1";tQuery.each=function(a,b){for(var c=0;c<a.length;c++)if(!1===b(a[c]))return!1;return!0};
tQuery.inherit=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.parent=b.prototype;a.prototype.constructor=a};tQuery.extend=function(a,b){var c={};b&&Object.keys(b).forEach(function(a){c[a]=b[a]});a&&Object.keys(a).forEach(function(b){c[b]=a[b]});return c};
tQuery.pluginsMixin=function(a,b){b=b||a.prototype||a;a.register=function(a,d){if(b[a])throw Error("Conflict! Already method called: "+a);b[a]=d};a.unregister=function(a){if(!1===b.hasOwnProperty(a))throw Error("Plugin not found: "+a);delete b[a]};a.registered=function(a){return!0===b.hasOwnProperty(a)}};tQuery.pluginsMixin(tQuery,tQuery);tQuery.register("createWorld",function(){return new tQuery.World});tQuery.register("createLoop",function(a){return new tQuery.Loop(a)});
tQuery.register("createCube",function(){var a=new THREE.MeshNormalMaterial,b=new THREE.CubeGeometry(1,1,1);b.dynamic=!0;a=new THREE.Mesh(b,a);return tQuery(a)});tQuery.register("createTorus",function(){var a=new THREE.MeshNormalMaterial,b=new THREE.TorusGeometry(0.35,0.15);b.dynamic=!0;a=new THREE.Mesh(b,a);return tQuery(a)});tQuery.register("createSphere",function(){var a=new THREE.MeshNormalMaterial,b=new THREE.SphereGeometry(0.5,0.5);b.dynamic=!0;a=new THREE.Mesh(b,a);return tQuery(a)});
tQuery.register("createAxis",function(){var a=new THREE.AxisHelper;a.scale.multiplyScalar(0.025);return tQuery(a)});tQuery.Node=function(a){this._lists=a instanceof Array?a:a?[a]:[];this.length=this._lists.length};tQuery.Node.prototype.get=function(a){if(void 0===a)return this._lists;console.assert(this._lists[a],"element not defined");return this._lists[a]};tQuery.Node.prototype.each=function(a){for(var b=0;b<this._lists.length;b++)if(!1===a(this._lists[b],b,this._lists))return!1;return!0};
tQuery.Node.prototype.back=function(a){if(void 0===a)return this._back;this._back=a;return this};tQuery.Object3D=function(a,b){"string"===typeof a&&(a=tQuery.Object3D._select(a,b));this.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Object3D)})};tQuery.inherit(tQuery.Object3D,tQuery.Node);tQuery.pluginsMixin(tQuery.Object3D);tQuery.Object3D.prototype.geometry=function(){var a=[];this.each(function(b){a.push(b.geometry)});return(new tQuery.Geometry(a)).back(this)};
tQuery.Object3D.prototype.material=function(){var a=[];this.each(function(b){a.push(b.material)});return new tQuery.Material(a)};tQuery.Object3D.prototype.addTo=function(a){console.assert(a instanceof tQuery.World);this.each(function(b){a.add(b)}.bind(this));return this};tQuery.Object3D.prototype.removeFrom=function(a){console.assert(a instanceof tQuery.World);this.each(function(b){a.remove(b)}.bind(this));return this};
tQuery.Object3D.prototype.id=function(a){console.assert(1>=this.length,"tQuery.Object3D.id used on multi-elements");if(void 0!==a){if(0<this.length){var b=this.get(0);b._tqId=a}return this}if(0<this.length)return b=this.get(0),b._tqId};tQuery.Object3D.prototype.addClass=function(a){this.each(function(b){b._tqClasses=b._tqClasses||"";tQuery.Object3D._hasClassOne(b,a)||(b._tqClasses+=" "+a)}.bind(this));return this};
tQuery.Object3D.prototype.removeClass=function(){console.assert(!1,"not yet implemented");return this};tQuery.Object3D.prototype.hasClass=function(a){return this.each(function(b){b._tqClasses=b._tqClasses||"";return tQuery.Object3D._hasClassOne(b,a)?!1:!0}.bind(this))?!1:!0};tQuery.Object3D._hasClassOne=function(a,b){return void 0===a._tqClasses?!1:a._tqClasses.match(RegExp("(^| |\t)+("+b+")($| |\t)+"))?!0:!1};
tQuery.Object3D._select=function(a,b){var b=b||tQuery.world.scene(),c=a.split(" ").filter(function(a){return 0<a.length});return this._crawls(b,c)};tQuery.Object3D._crawls=function(a,b){var c=[];console.assert(1<=b.length);var d=this._selectItemMatch(a,b[0])?b.slice(1):b;if(0===d.length)return[a];a.children.forEach(function(a){a=this._crawls(a,d);c=c.concat(a)}.bind(this));return c};
tQuery.Object3D._selectItemMatch=function(a,b){console.assert(a instanceof THREE.Object3D);console.assert("string"===typeof b);var c="buffer,cube,cylinder,extrude,icosahedron,lathe,octahedron,plane,sphere,text,torus,torusknot".split(","),d=b.match(RegExp("([^.#]+|.[^.#]+|#[^.#]+)","g"));return tQuery.each(d,function(b){var d=b.charAt(0),f=b.slice(1);if("."===d)return tQuery.Object3D._hasClassOne(a,f)?!0:!1;if("#"===d)return a._tqId===f?!0:!1;if(-1!==c.indexOf(b))return d=a.geometry,b=b.charAt(0).toUpperCase()+
b.slice(1)+"Geometry",d instanceof THREE[b];console.assert(!1,"invalid selector: "+b);return!0}.bind(this))?!0:!1};tQuery.Geometry=function(a){this.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Geometry)})};tQuery.inherit(tQuery.Geometry,tQuery.Node);tQuery.pluginsMixin(tQuery.Geometry);tQuery.Material=function(a){this.parent.constructor.call(this,a);this._lists.forEach(function(a){console.assert(a instanceof THREE.Material)})};
tQuery.inherit(tQuery.Material,tQuery.Node);tQuery.pluginsMixin(tQuery.Material);
tQuery.World=function(){tQuery.world=this;this._scene=new THREE.Scene;if(this._hasWebGL)this._renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),this._renderer.setClearColorHex(12303291,1);else throw this._addGetWebGLMessage(),Error("WebGL required and not available");this._renderer.setSize(window.innerWidth,window.innerHeight);this._camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1E4);this._camera.position.set(0,0,5);this._scene.add(this._camera);
this._loop=new tQuery.Loop(this)};tQuery.pluginsMixin(tQuery.World);tQuery.World.prototype.destroy=function(){this._loop.destroy();var a=this._renderer.domElement.parentElement;a&&a.removeChild(this._renderer.domElement)};tQuery.World.prototype._hasWebGL=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}();
tQuery.World.prototype._addGetWebGLMessage=function(a){var a=a||document.body,b=document.createElement("div");b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.textAlign="center";b.style.background="#eee";b.style.color="#000";b.style.padding="1em";b.style.width="475px";b.style.margin="5em auto 0";b.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/">here</a>.':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/">here</a>.';a.appendChild(b)};tQuery.World.prototype.add=function(a){a instanceof tQuery.Object3D?a.each(function(a){this._scene.add(a)}.bind(this)):a instanceof THREE.Object3D?this._scene.add(a):console.assert(!1,"invalid type");return this};
tQuery.World.prototype.remove=function(a){a instanceof tQuery.Object3D?a.each(function(a){this._scene.remove(a)}.bind(this)):a instanceof THREE.Object3D?this._scene.remove(a):console.assert(!1,"invalid type");return this};tQuery.World.prototype.appendTo=function(a){a.appendChild(this._renderer.domElement);this._renderer.setSize(a.offsetWidth,a.offsetHeight);return this};tQuery.World.prototype.start=function(){this._loop.start();return this};
tQuery.World.prototype.stop=function(){this._loop.stop();return this};tQuery.World.prototype.fullpage=function(){var a=document.body;a.style.margin="0";a.style.padding="0";a.style.overflow="hidden";return this.appendTo(a)};tQuery.World.prototype.loop=function(){return this._loop};tQuery.World.prototype.renderer=function(){return this._renderer};tQuery.World.prototype.camera=function(){return this._camera};tQuery.World.prototype.scene=function(){return this._scene};tQuery.World.prototype.get=function(){return this._scene};
tQuery.World.prototype.render=function(){this._renderer.render(this._scene,this._camera)};tQuery.Loop=function(a){console.assert(!tQuery.loop);tQuery.loop=this;this._world=a;this._hooks=[];this._lastTime=null;this._world&&this.hookOnRender(function(){this._world.render()}.bind(this))};tQuery.pluginsMixin(tQuery.Loop);tQuery.Loop.prototype.destroy=function(){this.stop()};
tQuery.Loop.prototype.start=function(){this._timerId&&this.stop();this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));return this};tQuery.Loop.prototype.stop=function(){cancelAnimationFrame(this._timerId);this._timerId=null;return this};
tQuery.Loop.prototype._onAnimationFrame=function(a){this._timerId=requestAnimationFrame(this._onAnimationFrame.bind(this));a/=1E3;this._lastTime||(this._lastTime=a-1/60);var b=a-this._lastTime;this._lastTime=a;for(var c=0;c<=this._hooks.length;c++)if(void 0!==this._hooks[c])for(var d=this._hooks[c].slice(0),e=0;e<d.length;e++)d[e](b,a)};tQuery.Loop.prototype.PRE_RENDER=20;tQuery.Loop.prototype.ON_RENDER=50;tQuery.Loop.prototype.POST_RENDER=80;
tQuery.Loop.prototype.hook=function(a,b){"function"===typeof a&&(b=a,a=this.PRE_RENDER);this._hooks[a]=this._hooks[a]||[];console.assert(-1===this._hooks[a].indexOf(b));this._hooks[a].push(b);return this};tQuery.Loop.prototype.unhook=function(a,b){var c=this._hooks[a].indexOf(b);console.assert(-1!==c);this._hooks[a].splice(c,1);0===this._hooks[a].length&&delete this._hooks[a];return this};tQuery.Loop.prototype.hookPreRender=function(a){return this.hook(this.PRE_RENDER,a)};
tQuery.Loop.prototype.hookOnRender=function(a){return this.hook(this.ON_RENDER,a)};tQuery.Loop.prototype.hookPostRender=function(a){return this.hook(this.POST_RENDER,a)};tQuery.Loop.prototype.unhookPreRender=function(a){return this.unhook(this.PRE_RENDER,a)};tQuery.Loop.prototype.unhookOnRender=function(a){return this.unhook(this.ON_RENDER,a)};tQuery.Loop.prototype.unhookPostRender=function(a){return this.unhook(this.POST_RENDER,a)};
(function(){var a=function(a){this._loop=a||tQuery.loop;this._controls=new THREEx.DragPanControls(tQuery.world.camera());this._$onRender=this._onRender.bind(this);this._loop.hookPreRender(this._$onRender)};a.prototype.destroy=function(){this._loop.unhookPreRender(this._$onRender)};a.prototype._onRender=function(){this._controls.update()};tQuery.register("DragPanControls",a);tQuery.register("createDragPanControls",function(a){return new tQuery.DragPanControls(a)})})();
(function(){tQuery.Geometry.register("zoom",function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.vector3 parameter error");this.each(function(b){for(var c=0;c<b.vertices.length;c++)b.vertices[c].position.multiplySelf(a);b.__dirtyVertices=!0;b.computeBoundingBox()});return this});tQuery.Geometry.register("size",function(){console.assert(1>=
this.length);if(0!==this.length){var a=this.get(0),b=new THREE.Vector3;b.x=a.boundingBox.max.x-a.boundingBox.min.x;b.y=a.boundingBox.max.y-a.boundingBox.min.y;b.z=a.boundingBox.max.z-a.boundingBox.min.z;return b}});tQuery.Geometry.register("normalize",function(){this.each(function(a){var a=tQuery(a),b=a.size();b.x>=b.y&&b.x>=b.z?a.scale(1/b.x):b.y>=b.x&&b.y>=b.z?a.scale(1/b.y):a.scale(1/b.z)});return this});tQuery.Geometry.register("middlePoint",function(){console.assert(1>=this.length);if(0!==this.length){var a=
this.get(0),b=new THREE.Vector3;b.x=(a.boundingBox.max.x+a.boundingBox.min.x)/2;b.y=(a.boundingBox.max.y+a.boundingBox.min.y)/2;b.z=(a.boundingBox.max.z+a.boundingBox.min.z)/2;return b}});tQuery.Geometry.register("translate",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.translate parameter error");this.each(function(b){for(var c=0;c<b.vertices.length;c++)b.vertices[c].position.addSelf(a);
b.__dirtyVertices=!0;b.computeBoundingBox()});return this});tQuery.Geometry.register("rotate",function(a,b){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.rotate parameter error");var b=b||"XYZ",c=new THREE.Matrix4;c.setRotationFromEuler(a,b);this.each(function(a){a.applyMatrix(c);a.__dirtyVertices=!0;a.computeBoundingBox()});return this});tQuery.Geometry.register("center",function(a,b,c){this.each(function(){var d=
this.middlePoint().negate();a&&(d.x=0);b&&(d.y=0);c&&(d.z=0);return this.translate(d)});return this})})();
(function(){tQuery.Object3D.register("scale",function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Geometry.scale parameter error");this.each(function(b){b.scale.copy(a)});return this});tQuery.Object3D.register("position",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));
console.assert(a instanceof THREE.Vector3,"Object3D.position parameter error");this.each(function(b){b.position.copy(a)});return this});tQuery.Object3D.register("rotation",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotation parameter error");this.each(function(b){b.rotation.copy(a)});return this});tQuery.Object3D.register("translate",function(a){"number"===typeof a&&3===arguments.length&&
(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.translate parameter error");this.each(function(b){b.position.addSelf(a)});return this});tQuery.Object3D.register("rotate",function(a){"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(b){b.rotation.addSelf(a)});return this});tQuery.Object3D.register("zoom",
function(a){"number"===typeof a&&1===arguments.length?a=new THREE.Vector3(a,a,a):"number"===typeof a&&3===arguments.length&&(a=new THREE.Vector3(arguments[0],arguments[1],arguments[2]));console.assert(a instanceof THREE.Vector3,"Object3D.rotate parameter error");this.each(function(b){b.scale.multiplySelf(a)});return this});tQuery.Object3D.register("translateX",function(a){return this.translate(a,0,0)});tQuery.Object3D.register("translateY",function(a){return this.translate(0,a,0)});tQuery.Object3D.register("translateZ",
function(a){return this.translate(0,0,a)});tQuery.Object3D.register("rotateX",function(a){return this.rotate(a,0,0)});tQuery.Object3D.register("rotateY",function(a){return this.rotate(0,a,0)});tQuery.Object3D.register("rotateZ",function(a){return this.rotate(0,0,a)});tQuery.Object3D.register("zoomX",function(a){return this.zoom(a,0,0)});tQuery.Object3D.register("zoomY",function(a){return this.zoom(0,a,0)});tQuery.Object3D.register("zoomZ",function(a){return this.zoom(0,0,a)})})();
(function(){var a=function(a){this._stats=new Stats;this._stats.domElement.style.position="absolute";this._stats.domElement.style.bottom="0px";document.body.appendChild(this._stats.domElement);this._loop=a||tQuery.loop;this._$onRender=this._onRender.bind(this);this._loop.hookPostRender(this._$onRender)};a.prototype.destroy=function(){this._loop.unhookPostRender(this._$onRender);document.body.removeChild(this._stats.domElement)};a.prototype._onRender=function(){this._stats.update()};tQuery.register("Stats",
a);tQuery.register("createStats",function(a){return new tQuery.Stats(a)})})();
