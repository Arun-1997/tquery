<!-- # Examples of tQuery.car.js -->



<!-- ```tquery.car.js``` is a plugin provides rendering and controls of sport cars. -->
<!-- It is based on some examples by [alteredq](http://alteredqualia.com/) in -->
<!-- [three.js](http://github.com/mrdoob/three.js/). -->
<!-- You can find them -->
<!-- [here](http://mrdoob.github.com/three.js/examples/webgl_materials_cars.html) -->
<!-- and -->
<!-- [here](http://mrdoob.github.com/three.js/examples/webgl_materials_cubemap_dynamic.html). -->

<!-- -->

<!doctype html><title>tQuery Car Example</title>
<script src="../../../build/tquery-bundle.js"></script>
<script src="../../requirejs/tquery.norequirejs.js"></script>

<script src='../../grassground/tquery.grassground.js'></script>

<script src='../../light/tquery.light.shadow.js'></script>

<script src="../../skymap/tquery.cubetexture.js"></script>
<script src="../../skymap/tquery.skymap.js"></script>

<script src="../../../vendor/three.js/ShaderExtras.js"></script>
<script src="../../../vendor/three.js/postprocessing/EffectComposer.js"></script>
<script src="../../../vendor/three.js/postprocessing/BloomPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/DotScreenPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/FilmPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/MaskPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/RenderPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/SavePass.js"></script>
<script src="../../../vendor/three.js/postprocessing/ShaderPass.js"></script>
<script src="../../../vendor/three.js/postprocessing/TexturePass.js"></script>
<script src="../../pproc/tquery.effectcomposer.js"></script>

<script src="../../minecraft/tquery.minecraftchar.js"></script>

<script src="../../minecraft/tquery.animation.js"></script>
<script src="../../minecraft/tquery.animations.js"></script>

<script src="../../minecraft/tquery.minecraftcharanimations.js"></script>
<script src="../../minecraft/tquery.minecraftcharheadanimations.js"></script>

<script src="../../minecraft/tquery.minecraftitems.js"></script>

<script src="../../materials/tquery.meshlambertmaterial.js"></script>
<script src="../../materials/tquery.meshphongmaterial.js"></script>
<script src="../../materials/tquery.meshbasicmaterial.js"></script>

<body><script>
	var world	= tQuery.createWorld().boilerplate().start();
	// no camera controls is needed
	world.removeCameraControls();
	world.tCamera().position.y	= 2;
	world.tCamera().position.z	= 10;
	world.tCamera().position.normalize().setLength(2)
	world.tCamera().lookAt(world.tScene().position.clone().addSelf(new THREE.Vector3(0,0.5,0)));

	// enable shadow casting in world renderer
	world.tRenderer().shadowMapEnabled	= true;
	world.tRenderer().shadowMapSoft		= true;

	// add a light with shadow casting
	tQuery.createDirectionalLight().addTo(world)
		.position(-10, 20, 30).color(0xffffff).intensity(4)
		.castShadow(true).shadowDarkness(0.8)
		.shadowMap(512*2,512*2)
		.shadowCamera(10, -10, 20, -20, 0.1, 50);

	// add some posteffect
	world.addEffectComposer().vignette().finish();

	// add a skymap
	tQuery.createSkymap('skybox').addTo(world);

	var ground	= tQuery.createGrassGround({
		textureUrl	: '../../grassground/images/grasslight-big.jpg',
		textureRepeatX	: 10,
		textureRepeatY	: 10,		
	}).addTo(world).scaleBy(100).receiveShadow(true);
	
	var character	= new tQuery.MinecraftChar({
		skinUrl	: "../../minecraft/examples/images/char.png"
	});
	character.model.addTo(world)

	tQuery('mesh', character.model).castShadow(true)
// TODO
// - shadow casting
// - make it move with path
// - keyboard control

	character.model.rotateY(-Math.PI/6);
	character.model.translateX(0.5);
	character.model.translateZ(0.5);
	character.model.translateY(0.5);

	var bodyAnims	= new tQuery.MinecraftCharAnimations();
	bodyAnims.start('hiwave');

	var headAnims	= new tQuery.MinecraftCharHeadAnimations();
	headAnims.start('yes');
	
	var items	= new tQuery.MinecraftItems({
		url	: '../../minecraft/examples/images/items/items.png'
	});
	items.bind('load', function(){
		var item	= items.createMesh(10+2*16).addTo(world);
		
		item.translateX(-0.5)
		item.translateY(0.5)
		item.castShadow(true)
		var canvas	= document.createElement('canvas');
		var context	= canvas.getContext('2d');
		context.fillStyle	= "rgba(80, 48, 32, 1)";
		context.fillRect(0, 0, canvas.width, canvas.height);  

		context.fillStyle	= "rgb(230,230,230)"; 
		context.font	= "900 "+(2*24)+"px Arial";
		var print	= function(x, y, text){
			context.fillText(text, 8+(16*x), 28+(28*y));
		}
		print(2,1, "Hello")
		print(7,3, "#bbg !!")



		var url		= '../../grassground/images/grasslight-big.jpg';
		var mesh	= tQuery.createPlane().addTo(item)
			.geometry()
				.rotateX(Math.PI/2)
				.translateX(1/16)
				.translateY(3/16 + 0.5/16)
				.translateZ(1/16+0.1)
				.scaleBy(11/16, 7/16,1)
				.back()
			.setBasicMaterial().ambient(0x444444).color(0xffffff).map(canvas).transparent(true).back()
			.castShadow(true)
	});


</script></body>