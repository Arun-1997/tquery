<!doctype html><title>Minimal tQuery Page</title> 
<script src="../../../build/tquery-bundle-require.js"></script>

<script src="../vendor/MTLLoader.js">	</script>
<script src="../vendor/OBJMTLLoader.js"></script>
		
<body><script>
require(['tquery.minecraft'], function(){
	var world	= tQuery.createWorld().boilerplate().start();

	// set the url of the model to load
	var urlObj	= 'models/appart_hiphop/world134_1.obj';
	var urlMtl	= 'models/appart_hiphop/world134_1.mtl';
	
	var urlObj	= 'models/beloolaData/codelyoko/codelyoko.obj';
	var urlMtl	= 'models/beloolaData/codelyoko/codelyoko.mtl';

	// load the model
if(true){	
	var loader	= new THREE.OBJMTLLoader();
	loader.load(urlObj, urlMtl);
	loader.addEventListener('load', function(event){
		var tObject3D	= event.content;

		var objFull	= tQuery(tObject3D).clone().addTo(world);
	 	var material	= tQuery.createMeshLambertMaterial();
		objFull.traverse(function(child){
			child.material	= material.get(0);
		});

		var objWire	= tQuery(tObject3D).clone().addTo(world);
		var material	= tQuery.createMeshBasicMaterial().wireframe(true);
		objWire.traverse(function(child){
			child.material	= material.get(0);
		});
	});
}
	
	// create minecraft character
	var character	= tQuery.createMinecraftChar().addTo(world);
	var character3D	= character.object3D();
	character3D.scale(1.6)
	// to enable a tracking camera
	var cameraControls	= tQuery.createCameraFpsControls({
		trackedObject	: character3D.get(0),
		tCamera		: world.tCamera(),
	});
	world.setCameraControls(cameraControls)
	// add keyboard controls
	tQuery.createMinecraftCharKeyboard2({
		object3D	: character3D,
	});


	// make it run only if it move		
	var bodyAnims	= new tQuery.MinecraftCharAnimations(character);
	var prevPosition= tQuery.createVector3();
	world.loop().hook(function(){
		// compute velocity
		var velocity	= character3D.position().clone().subSelf(prevPosition);
		// pick animation based
		if( velocity.length() ){
			bodyAnims.start('walk')
		}else{
			bodyAnims.start('stand')
		}
		// update prevRotation
		prevPosition.copy( character3D.position() );		
	})


	// change material for character3D
	tQuery('mesh', character3D).each(function(tObject3D){
		var tMaterial	= tObject3D.material;
		new tQuery.Mesh(tObject3D)
			.setLambertMaterial()
				.ambient(0x888888)
				.color(0xcccccc)
				.map(tMaterial.map)
				.transparent(tMaterial.transparent)
				.side(tMaterial.side)
			.back()
	});



	//tQuery.createAmbientLight().addTo(world).color(0x444444);
	// var lightDir	= tQuery.createDirectionalLight().addTo(world)
	// 	.position(1,1,-1)
	// 	.color(0xff00ff)
	// var helper	= new THREE.DirectionalLightHelper(lightDir.get(0), 1, 1);
	// tQuery(helper).addTo(world);
		
	// var pointLight	= tQuery.createPointLight().addTo(world)
	// 	.position(1,1,-1)
	// 	.color(0x0000ff)
	// 	.intensity(1);

	// window.pointLight	= pointLight;

	// tQuery.createSphere()
	// 	.scale(0.5)
	// 	.setBasicMaterial()
	// 		.wireframe(true)
	// 		.back()
	// 	.addTo(pointLight);

	var lightHemi	= tQuery.createHemisphereLight().addTo(world)
		.position(2,2,2)
		.color(0x444444)
		.intensity(2)
		.groundColor(0x008800)

	// tQuery.createSphere()
	// 	.scale(0.5)
	// 	.setBasicMaterial()
	// 		.wireframe(true)
	// 		.back()
	// 	.addTo(lightHemi);
});
</script></body>