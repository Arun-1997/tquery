<!doctype html><title>Minimal tQuery Page</title> 
<script src="../../../build/tquery-bundle-require.js"></script>

<script src="../vendor/MTLLoader.js">	</script>
<script src="../vendor/OBJMTLLoader.js"></script>
<script src="tquery.heightmap.js">	</script>
		
<body><script>
require(['tquery.pproc', 'tquery.minecraft', 'tquery.keyboard'], function(){
	var world	= tQuery.createWorld().boilerplate().start();

	var character	= tQuery.createMinecraftChar({
		//skinUrl	: '../../minecraft/examples/images/agentsmith.png'
	}).addTo(world);
		
	// setup some lights
	tQuery.createAmbientLight().addTo(world)
		.color(0x444444)
	tQuery.createDirectionalLight().addTo(world)
		.color(0xffffff)
		.position(-1,1,1)
	tQuery.createDirectionalLight().addTo(world)
		.color(0xffffff)
		.position( 1,1,1)

	// init the heightmap
	var heightMap	= new tQuery.HeightMap({
		url	: 'models/appart_hiphop/heightmap134.png',
		bboxMin	: tQuery.createVector3(0, 0.03, -8.2),
		bboxMax	: tQuery.createVector3(23, 16.03, 0),
	})

/**
 * # about heightmap
 * * make a class for it
 * * heightmap.heightAt(THREE.Vector3)
 * * heightmap.debug(true)
 */

	var mapScale	= 1/45
	var mapObject3D	= tQuery.createPlane().addTo(world)
		.scaleX(1024 * mapScale)
		.scaleY( 365 * mapScale)
		.rotateX(-Math.PI/2)
		.translateX(-4.5)
		.translateZ(-0.07)
		.setBasicMaterial()
			.map('models/appart_hiphop/heightmap134.png')
			.back()

	world.loop().hook(function(){
		var positionY	= character.object3D().positionY();
		mapObject3D.positionY(positionY + 0.5);
		
		var visible	= tQuery.keyboard().pressed('m') ? false : true;
		mapObject3D.visible(visible)
	})



	// set the url of the model to load
	var urlObj	= 'models/appart_hiphop/world134_1.obj';
	var urlMtl	= 'models/appart_hiphop/world134_1.mtl';

	// load the model
	var loader	= new THREE.OBJMTLLoader();
	loader.load(urlObj, urlMtl);
	loader.addEventListener('load', function(event){
		tQuery(event.content).addTo(world)
			.position(-16, -8, 4)
	});


	world.loop().hook(function(delta, now){
		character.object3D('root').rotateY(delta * Math.PI * 2 * 0.1)
	})
});
</script></body>
