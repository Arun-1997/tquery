<!doctype html><title>Minimal tQuery Page</title>
<script src="../../../build/tquery-bundle-require.js"></script>
<script src='../vendor/webrtc.io-client/webrtc.io.js'></script>
<body>
<script>
require([], function(){
	var world	= tQuery.createWorld().boilerplate().start();

	
	rtc.createStream({"video": true, "audio": true}, function(stream){
console.dir(stream)
		var texture	= createTexture(stream)
		tQuery.createPlane().addTo(world)
			.positionX(2 * Math.random()-0.5)
			.positionY(2 * Math.random()-0.5)
			.setBasicMaterial()
				.map(texture)
				.back()
	}, function(){
		console.log('createStream failed', arguments)
	});


	var room	= 'public';
	var serverUrl	= "ws://localhost:8000/";
	rtc.connect(serverUrl, room);
	
        rtc.on('add remote stream', function(stream, socketId) {
		var texture	= createTexture(stream)
		tQuery.createPlane().addTo(world)
			.positionX(2 * Math.random()-0.5)
			.positionY(2 * Math.random()-0.5)
			.setBasicMaterial()
				.map(texture)
				.back()     	
        });

        function createTexture(stream){
		var videoEl	= document.createElement('video');
		videoEl.width	= 320;
		videoEl.height	= 240;
		videoEl.autoplay= true;
		videoEl.loop	= true;	
		videoEl.src	= URL.createObjectURL(stream);

		var texture	= new THREE.Texture( videoEl );

		world.loop().hook(function(){
			if( videoEl.readyState === videoEl.HAVE_ENOUGH_DATA ){
				texture.needsUpdate	= true;
			}
		});
		return texture;        	
        }
});
</script></body>