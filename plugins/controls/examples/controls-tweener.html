<!doctype html><title>Minimal tQuery Page</title>
<script src="../../../build/tquery-bundle-require.js"></script>
<script src="../tquery.controlswrapper.js"></script>
<body><script>
require(['tquery.skymap'], function(){
	var world	= tQuery.createWorld().boilerplate().start();

	var source	= tQuery.createTorusKnot().addTo(world)
		.positionX(  1.5)
//		.rotationX(  Math.PI/2 )
		.rotationY( -Math.PI/3 )

	tQuery.createSkymap('mars').addTo(world);

	// world.removeCameraControls();
	// source.add( world.tCamera() );	
	// world.tCamera().position.z	= -3;
	// world.tCamera().rotation.y	= Math.PI;

	var target	= tQuery.createTorus().addTo(world)
		.positionX( -1.5)
		.rotationY( +Math.PI/3 )

	// leave a marker on the source position for debug	
	tQuery.createTorus().addTo(world)
		.position( source.position() )
		.rotation( source.rotation() )

// debug
world.tScene().updateMatrixWorld();
var sourceMat	= source.get(0).matrixWorld;
var sourceEuler	= source.get(0).eulerOrder;
var sourceRot	= tQuery.createVector3().setEulerFromRotationMatrix(sourceMat, source.get(0).eulerOrder);
console.log('sourceRot', sourceRot)

	// very basic controls
	var controls	= {
		update	: function(delta, now){
			
			// world.tScene().updateMatrixWorld();

			source.get(0).updateMatrixWorld();
			target.get(0).updateMatrixWorld();

			var sourceMat	= source.get(0).matrixWorld;
			var targetMat	= target.get(0).matrixWorld;

			var sourceEuler	= source.get(0).eulerOrder;
			var targetEuler	= target.get(0).eulerOrder;

			var sourcePos	= tQuery.createVector3().getPositionFromMatrix(sourceMat);
			var targetPos	= tQuery.createVector3().getPositionFromMatrix(targetMat);
			var deltaPos	= targetPos.clone().sub(sourcePos)
			deltaPos.multiplyScalar(0.03)
			source.translate(deltaPos);


			var sourceRot	= tQuery.createVector3().setEulerFromRotationMatrix(sourceMat, sourceEuler)
			var targetRot	= tQuery.createVector3().setEulerFromRotationMatrix(targetMat, targetEuler)
			var deltaRot	= targetRot.clone().sub(sourceRot)
			deltaRot.multiplyScalar(0.03)
			source.rotate(deltaRot);
		}
	};
	
	// var controls	= {
	// 	update	: function(delta, now){
			
	// 		world.tScene().updateMatrixWorld();
	// 		var sourcePos	= source.position();
	// 		var targetPos	= target.position();
	// 		var deltaPos	= targetPos.clone().sub(sourcePos)
	// 		deltaPos.multiplyScalar(0.01)
	// 		sourcePos.add(deltaPos);

	// 		// var sourceRot	= source.rotation();
	// 		// var targetRot	= target.rotation();
	// 		// var deltaRot	= targetRot.clone().sub(sourceRot)
	// 		// deltaRot.multiplyScalar(0.01)
	// 		// sourceRot.add(deltaRot);
	// 	}
	// };
	// wrapper for this controls
	tQuery.createControlsWrapper({
		controls	: controls
	});	
})
</script></body>