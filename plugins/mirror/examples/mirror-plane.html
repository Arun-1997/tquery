<!doctype html><title>Minimal tQuery Page</title>
<script src="../../../build/tquery-bundle-require.js"></script>
<body><script>
require([ 'tquery.skymap'
	, 'tquery.grassground'
	, 'tquery.minecraft'
], function(){
	var world	= tQuery.createWorld().boilerplate().start();

	tQuery.createSkymap('bridge2').addTo(world);
	
	var container	= tQuery.createObject3D().addTo(world).positionY(-0.5)
	tQuery.createTorusKnot().addTo(container).position( 0, 0, 3)
	// tQuery.createTorusKnot().addTo(container).position( 0, 0,-3)
	// tQuery.createTorusKnot().addTo(container).position( 3, 0, 0).rotateY( Math.PI/2)
	// tQuery.createTorusKnot().addTo(container).position(-3, 0, 0).rotateY(-Math.PI/2)
	
	world.hook(function(delta, now){
		container.rotateY( 0.3 * delta * Math.PI*2)
	})
	
	
	var textureW	= 512;
	var textureH	= 512;
	var rtTexture	= new THREE.WebGLRenderTarget(textureW, textureH, {
		minFilter	: THREE.LinearFilter,
		magFilter	: THREE.NearestFilter,
		format		: THREE.RGBFormat
	});
	
	var tPlaneCam	= new THREE.PerspectiveCamera(35, textureW/textureH, 0.0001, 10000);
	

	world.hook(function(delta, now){
		var tRenderer	= world.tRenderer();
		tRenderer.render( world.tScene(), tPlaneCam, rtTexture, true );	
	})
	
	
	var mirror	= tQuery.createPlane().addTo(world)
		.geometry()
			.scaleBy(2)
			.back()
		//.translateX(-1.5)
		//.translateZ(-2)
		.rotateY(Math.PI)
		.setBasicMaterial()
			.map(rtTexture)
			.side(THREE.BackSide)
			.back()

	tQuery(tPlaneCam).addTo(mirror)
		//.rotateY(Math.PI)
	tQuery.createAxis().addTo(tPlaneCam)
		//.rotateY(-Math.PI)

	var camera	= tQuery(tPlaneCam)
	window.camera	= camera;
	window.mirror	= mirror;
	window.world	= world;
	
	var planeNormal	= tQuery.createVector3(0,0,-1);	
	var normalObj	= tQuery.createCube().scale(1/10).position(planeNormal).addTo(world)
		.setBasicMaterial()
			.wireframe(true)
			.color('black')
			.back()


	var projectObj	= tQuery.createCube().addTo(world)
		.scale(1/10)
		.setBasicMaterial()
			.wireframe(true)
			.color('red')
			.back()
	window.projectObj	= projectObj

	var reflectObj	= tQuery.createCube().addTo(world)
		.scale(1/10)
		.setBasicMaterial()
			.wireframe(true)
			.color('blue')
			.back()

	var cameraObj	= tQuery.createCube().addTo(world)
		.scale(1/10)
		.setBasicMaterial()
			.wireframe(true)
			.color('hotpink')
			.back()

	world.hook(function(delta, now){	
		var mirrorPos	= mirror.position();
		var worldCamPos	= world.camera().position();
		//worldCamPos	= tQuery.createVector3(1, 0, 2)
		
		cameraObj.position(worldCamPos)
		
		var vector	= mirrorPos.clone().sub(worldCamPos);
		var projectPos	= planeNormal.clone().multiplyScalar(vector.dot(planeNormal));
		projectObj.position(projectPos)
		
		var reflectPos	= projectPos.clone().multiplyScalar(2).negate().add(vector)
			//.negate();
		reflectObj.position(reflectPos)
		
		tPlaneCam.lookAt(tQuery.createVector3(-reflectPos.x, reflectPos.y, -reflectPos.z))

		var quaternion	= new THREE.Quaternion()
		quaternion.setFromAxisAngle(reflectPos.clone().normalize(), 0)
		var euler	= new THREE.Vector3().setEulerFromQuaternion(quaternion);
		window.quaternion	= quaternion;
		window.euler		= euler
	})
})
</script></body>